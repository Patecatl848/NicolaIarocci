<!DOCTYPE html>
<html lang="en-US">
<head>

    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />

    
    
        <meta name="twitter:card" content="summary"/>
    



<meta name="twitter:title" content="Avviare un Download con richiesta di nome file da una pagina ASP.NET"/>
<meta name="twitter:description" content=""/>
<meta name="twitter:site" content="@"/>



  	<meta property="og:title" content="Avviare un Download con richiesta di nome file da una pagina ASP.NET &middot; Nicola Iarocci" />
  	<meta property="og:site_name" content="Nicola Iarocci" />
  	<meta property="og:url" content="https://nicolaiarocci.com/avviare-un-download-con-richiesta-di-nome-file-da-una-pagina-asp-net/" />

    
        
    

    
    <meta property="og:description" content="" />
  	<meta property="og:type" content="article" />
    <meta property="article:published_time" content="2011-04-27T00:00:00Z" />

    
    <meta property="article:tag" content="asp.net" />
    
    <meta property="article:tag" content="download" />
    
    <meta property="article:tag" content="pdf" />
    
    <meta property="article:tag" content="response.transmitfile()" />
    
    <meta property="article:tag" content="web" />
    
    

    <title>Avviare un Download con richiesta di nome file da una pagina ASP.NET &middot; Nicola Iarocci</title>

    
    <meta name="description" content="&lt;p&gt;&lt;img class=&#34;size-thumbnail wp-image-2251 alignright&#34; title=&#34;Download&#34; src=&#34;http://i0.wp.com/nicolaiarocci.com/wp-content/uploads/Download-150x150.png?fit=150" />
    

    <meta name="HandheldFriendly" content="True" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <link rel="shortcut icon" href="/images/favicon.ico">
	  <link rel="apple-touch-icon" href="/images/apple-touch-icon.png" />

    <link rel="stylesheet" type="text/css" href="/css/screen.css" />
    <link rel="stylesheet" type="text/css" href="/css/nav.css" />

    
    <link rel="stylesheet" href="/css/custom.css">
    

    

    
      
          <link href="/index.xml" rel="alternate" type="application/rss+xml" title="Nicola Iarocci" />
      
      
    
    <meta name="generator" content="Hugo 0.55.4" />

    <link rel="canonical" href="https://nicolaiarocci.com/avviare-un-download-con-richiesta-di-nome-file-da-una-pagina-asp-net/" />

    
      
    
    <script type="application/ld+json">
{
    "@context": "https://schema.org",
    "@type": "Article",
    "publisher": {
        "@type": "Organization",
        "name":  null 
    },
    "author": {
        "@type": "Person",
        "name":  null ,
        
        "url": "https://nicolaiarocci.com",
        "sameAs": [
            
            
             
             
             
             
             
            
        ]
    },
    "headline": "Avviare un Download con richiesta di nome file da una pagina ASP.NET",
    "name": "Avviare un Download con richiesta di nome file da una pagina ASP.NET",
    "wordCount":  450 ,
    "timeRequired": "PT3M",
    "inLanguage": {
      "@type": "Language",
      "alternateName": "en"
    },
    "url": "https://nicolaiarocci.com/avviare-un-download-con-richiesta-di-nome-file-da-una-pagina-asp-net/",
    "datePublished": "2011-04-27T00:00Z",
    "dateModified": "2011-04-27T00:00Z",
    
    "keywords": "asp.net, download, pdf, response.transmitfile(), web",
    "description": "",
    "mainEntityOfPage": {
        "@type": "WebPage",
        "@id": "https://nicolaiarocci.com/avviare-un-download-con-richiesta-di-nome-file-da-una-pagina-asp-net/"
    }
}
    </script>
    


    

    
    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-19006041-1', 'auto');
      ga('send', 'pageview');

    </script>
    

    
</head>
<body class="nav-closed">

  <div class="nav">
    <h3 class="nav-title">Menu</h3>
    <a href="#" class="nav-close">
        <span class="hidden">Close</span>
    </a>
    <ul>
        
        
        
            
            <li class="nav-opened" role="presentation">
            	<a href="/">Blog</a>
            </li>
        
            
            <li class="nav-opened" role="presentation">
            	<a href="/about">About</a>
            </li>
        
            
            <li class="nav-opened" role="presentation">
            	<a href="/opensource">Open Source</a>
            </li>
        
            
            <li class="nav-opened" role="presentation">
            	<a href="/talks">Speaking</a>
            </li>
        
            
            <li class="nav-opened" role="presentation">
            	<a href="/books-i-have-read">Reading</a>
            </li>
        
            
            <li class="nav-opened" role="presentation">
            	<a href="/il-piccolo-libro-di-mongodb-edizione-italiana">MongoDB</a>
            </li>
        
            <h3>Subscribe</h3>
            <li class="nav-opened" role="presentation">
            	<a href="http://eepurl.com/b-_Pzz">New posts via mail</a>
            </li>
        
            
            <li class="nav-opened" role="presentation">
            	<a href="https://nicolaiarocci.com/index.xml">RSS feed</a>
            </li>
        
            <h3>Follow me</h3>
            <li class="nav-opened" role="presentation">
            	<a href="https://twitter.com/nicolaiarocci">Twitter</a>
            </li>
        
            
            <li class="nav-opened" role="presentation">
            	<a href="https://github.com/nicolaiarocci">Github</a>
            </li>
        
            
            <li class="nav-opened" role="presentation">
            	<a href="https://stackoverflow.com/users/323269/nicola-iarocci?tab=profile">Stack Overflow</a>
            </li>
        
            
            <li class="nav-opened" role="presentation">
            	<a href="http://speakerdeck.com/u/nicola">Speaker Deck</a>
            </li>
        
            
            <li class="nav-opened" role="presentation">
            	<a href="http://www.linkedin.com/in/nicolaiarocci">LinkedIn</a>
            </li>
        
        
    </ul>

    
    <a class="subscribe-button icon-feed" href="/index.xml">Subscribe</a>
    
</div>
<span class="nav-cover"></span>


 <div class="site-wrapper">



<header class="main-header post-head no-cover">
  <nav class="main-nav clearfix">


  
  
      <a class="menu-button" href="#"><span class="burger">&#9776;</span><span class="word">Menu</span></a>
  
  </nav>
</header>



<main class="content" role="main">




  <article class="post post">

    <header class="post-header">
        <h1 class="post-title">Avviare un Download con richiesta di nome file da una pagina ASP.NET</h1>
        <small></small>

        <section class="post-meta">
        
          <time class="post-date" datetime="2011-04-27T00:00:00Z">
            Apr 27, 2011
          </time>
        
         
          <span class="post-tag small"><a href="https://nicolaiarocci.com//tags/asp.net/">#asp.net</a></span>
         
          <span class="post-tag small"><a href="https://nicolaiarocci.com//tags/download/">#download</a></span>
         
          <span class="post-tag small"><a href="https://nicolaiarocci.com//tags/pdf/">#pdf</a></span>
         
          <span class="post-tag small"><a href="https://nicolaiarocci.com//tags/response.transmitfile/">#response.transmitfile()</a></span>
         
          <span class="post-tag small"><a href="https://nicolaiarocci.com//tags/web/">#web</a></span>
         
        </section>
    </header>

    <section class="post-content">
      <p><img class="size-thumbnail wp-image-2251 alignright" title="Download" src="http://i0.wp.com/nicolaiarocci.com/wp-content/uploads/Download-150x150.png?fit=150%2C150" alt="" srcset="images/Download.png?resize=150%2C150 150w, http://i1.wp.com/nicolaiarocci.com/wp-content/uploads/Download.png?resize=90%2C90 90w, http://i1.wp.com/nicolaiarocci.com/wp-content/uploads/Download.png?w=256 256w" sizes="(max-width: 150px) 100vw, 150px" data-recalc-dims="1" />Normalmente quando un visitatore clicca su un link che punta a un file, quest&#8217;ultimo viene mostrato nel browser e non viene avviato alcun download. Questo succede perché il browser determina il tipo di contenuto in base alla estensione del file. Quando clicchiamo su un file con estensione jpg il browser sa che si tratta di una immagine e la mostra direttamente. Lo stesso avviene per i file pdf e così via.</p>

<p>Può capitare che questo comportamento non sia quello desiderato. Oggi <a title="Gestionale Amica" href="http://gestionaleamica.com" target="_blank">al lavoro</a> ho implementato una funzionalità interessante: il download della versione PDF di una pagina web. Il pdf viene costruito dinamicamente nel momento stesso in cui il visitatore clicca un link. Questo accorgimento libera il webmaster dalla tediosa (e facilmente dimenticabile) necessità di rigenerare il pdf ad ogni minimo ritocco della pagina.</p>

<div id="attachment_2230" style="width: 460px" class="wp-caption aligncenter">
  <a href="http://i0.wp.com/nicolaiarocci.com/wp-content/uploads/PDFSchedeProdotto.png" rel="lightbox[2229]"><img class="size-full wp-image-2230" title="Generazione dinamica del PDF della pagina web" src="http://i0.wp.com/nicolaiarocci.com/wp-content/uploads/PDFSchedeProdotto.png?fit=450%2C181" alt="Generazione dinamica del PDF della pagina web" srcset="http://i0.wp.com/nicolaiarocci.com/wp-content/uploads/PDFSchedeProdotto.png?w=623 623w, http://i0.wp.com/nicolaiarocci.com/wp-content/uploads/PDFSchedeProdotto.png?resize=150%2C60 150w, http://i0.wp.com/nicolaiarocci.com/wp-content/uploads/PDFSchedeProdotto.png?resize=300%2C120 300w, http://i0.wp.com/nicolaiarocci.com/wp-content/uploads/PDFSchedeProdotto.png?resize=500%2C200 500w" sizes="(max-width: 450px) 100vw, 450px" data-recalc-dims="1" /></a>
  
  <p class="wp-caption-text">
    Il visitatore clicca sul link e ottiene il PDF della pagina che sta guardando
  </p>
</div>

<p>Volevo che cliccando sul link si avviasse automaticamente il download, così da &#8216;costringere&#8217; l&#8217;utente a interagire col PDF in un secondo tempo rispetto all&#8217;esperienza di navigazione. Se scarichi un PDF è per stamparlo o consultarlo con calma o magari passarlo a un collega, no?</p>

<p>Costringere l&#8217;utente a usare il menu contestuale del browser (<em>Salva link con nome..</em>) non è certo la scelta ideale dal punto di vista dell&#8217;esperienza utente, tanto più che in questo caso il link non è statico e invoca codice JavaScript. Per ottenere il risultato desiderato dobbiamo inviare direttamente il file all&#8217;utente. [cci_asp theme=&#8221;standard&#8221;]Response.TransmitFile()[/cci_asp] è il metodo che invia il file dall&#8217;applicazione ASP.NET al client, ma prima dobbiamo preoccuparci di aggiungere un paio di header al nostro messaggio di output:</p>

<pre class="brush:vb">Public Sub SendFile(ByVal filename As String)
        'Author: Nicola Iarocci http://nicolaiarocci.com
        Response.Buffer = True
        Response.Charset = ""
        Response.Cache.SetCacheability(HttpCacheability.NoCache)
        Response.ContentType = "application/pdf"
        Response.AddHeader("content-disposition", "attachment;filename=" & Path.GetFileName(filename))
        Response.TransmitFile(filename)
        Response.End()
    End Sub</pre>

<p>E&#8217; importante fornire il ContentType corretto altrimenti il browser non sarà sempre in grado di gestire i contenuti del file. Internet Explorer per esempio offre l&#8217;opzione di aprire direttamente il file (verrà scaricato nella cache). Nel nostro caso se l&#8217;utente sceglie l&#8217;apertura diretta IE lancerà Acrobat Reader perché ContentType è <em>application/pdf</em>.</p>

<p>Altro accorgimento è la chiamata al metodo Path.GetFileName() in riga 7. Non sarebbe necessario se non fosse che <em>taluni broswer arcaici e superati</em> (ogni riferimento a IE è naturalmente voluto) non sono in grado di gestire intelligentemente il filename e, quando propongono il nome del file da salvare, riproducono l&#8217;intero path del file sul server. Questo comportamento tra l&#8217;altro è pericoloso perché espone l&#8217;intera struttura  del sito, dalla radice al folder che contiene la pagina, al visitatore.</p>

<p>Se la routine deve essere usata in un modulo e non direttamente in una pagina aspx ricordate di sostituire Response con HttpContect.Current.Response. Buon lavoro!</p>
    </section>


  <footer class="post-footer">


    









<section class="author">
  <h4><a href="https://nicolaiarocci.com/">Nicola Iarocci</a></h4>
  
  <p>Read <a href="https://nicolaiarocci.com/">more posts</a> by this author.</p>
  
  <div class="author-meta">
    <span class="author-location icon-location">Ravenna, Italy</span>
    <span class="author-link icon-link"><a href="https://nicolaiarocci.com">https://nicolaiarocci.com</a></span>
  </div>
</section>




    
<section class="share">
  <h4>Share this post</h4>
  <a class="icon-twitter" style="font-size: 1.4em" href="https://twitter.com/share?text=Avviare%20un%20Download%20con%20richiesta%20di%20nome%20file%20da%20una%20pagina%20ASP.NET&nbsp;-&nbsp;Nicola%20Iarocci&amp;url=https%3a%2f%2fnicolaiarocci.com%2favviare-un-download-con-richiesta-di-nome-file-da-una-pagina-asp-net%2f"
      onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;">
      <span class="hidden">Twitter</span>
  </a>
  <a class="icon-facebook" style="font-size: 1.4em" href="https://www.facebook.com/sharer/sharer.php?u=https%3a%2f%2fnicolaiarocci.com%2favviare-un-download-con-richiesta-di-nome-file-da-una-pagina-asp-net%2f"
      onclick="window.open(this.href, 'facebook-share','width=580,height=296');return false;">
      <span class="hidden">Facebook</span>
  </a>
  <a class="icon-pinterest" style="font-size: 1.4em" href="http://pinterest.com/pin/create/button/?url=https%3a%2f%2fnicolaiarocci.com%2favviare-un-download-con-richiesta-di-nome-file-da-una-pagina-asp-net%2f&amp;description=Avviare%20un%20Download%20con%20richiesta%20di%20nome%20file%20da%20una%20pagina%20ASP.NET"
      onclick="window.open(this.href, 'pinterest-share','width=580,height=296');return false;">
      <span class="hidden">Pinterest</span>
  </a>
  <a class="icon-google-plus" style="font-size: 1.4em" href="https://plus.google.com/share?url=https%3a%2f%2fnicolaiarocci.com%2favviare-un-download-con-richiesta-di-nome-file-da-una-pagina-asp-net%2f"
     onclick="window.open(this.href, 'google-plus-share', 'width=490,height=530');return false;">
      <span class="hidden">Google+</span>
  </a>
</section>



    







  </footer>
</article>

</main>


  <aside class="read-next">
  
      <a class="read-next-story" style="no-cover" href="/costruire-siti-fluidi-coi-css-framework-tiny-fluid-grid/">
          <section class="post">
              <h2>Costruire siti fluidi coi CSS Framework: Tiny Fluid Grid</h2>
              
          </section>
      </a>
  
  
      <a class="read-next-story prev" style="no-cover" href="/servire-500-milioni-di-utenti-al-mese-con-python-e-django/">
          <section class="post">
              <h2>Servire 500 milioni di utenti con Python e Django</h2>
          </section>
      </a>
  
</aside>



    <footer class="site-footer clearfix">
        <section class="copyright"><a href="">Nicola Iarocci</a> All rights reserved</section>
        
    </footer>
    </div>
    <script type="text/javascript" src="/js/jquery.js"></script>
    <script type="text/javascript" src="/js/jquery.fitvids.js"></script>
    <script type="text/javascript" src="/js/index.js"></script>
    
</body>
</html>

