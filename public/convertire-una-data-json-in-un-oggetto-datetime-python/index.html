<!DOCTYPE html>
<html lang="en-US">
<head>

    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />

    
    
        <meta name="twitter:card" content="summary"/>
    



<meta name="twitter:title" content="Convertire una data JSON in un oggetto datetime Python"/>
<meta name="twitter:description" content=""/>
<meta name="twitter:site" content="@"/>



  	<meta property="og:title" content="Convertire una data JSON in un oggetto datetime Python &middot; Nicola Iarocci" />
  	<meta property="og:site_name" content="Nicola Iarocci" />
  	<meta property="og:url" content="https://nicolaiarocci.com/convertire-una-data-json-in-un-oggetto-datetime-python/" />

    
        
    

    
    <meta property="og:description" content="" />
  	<meta property="og:type" content="article" />
    <meta property="article:published_time" content="2012-06-07T00:00:00Z" />

    
    <meta property="article:tag" content="datetime" />
    
    <meta property="article:tag" content="json" />
    
    <meta property="article:tag" content="programmazione" />
    
    <meta property="article:tag" content="python" />
    
    

    <title>Convertire una data JSON in un oggetto datetime Python &middot; Nicola Iarocci</title>

    
    <meta name="description" content="Abbiamo una stringa JSON che contiene una data:
fonte = &#39;{&amp;quot;ragione_sociale&amp;quot;: &amp;quot;CIR 2000&amp;quot;, &amp;quot;aggiornato_il&amp;quot;: &amp;quot;Wed, 06 Jun 2012 1" />
    

    <meta name="HandheldFriendly" content="True" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <link rel="shortcut icon" href="/images/favicon.ico">
	  <link rel="apple-touch-icon" href="/images/apple-touch-icon.png" />

    <link rel="stylesheet" type="text/css" href="/css/screen.css" />
    <link rel="stylesheet" type="text/css" href="/css/nav.css" />

    
    <link rel="stylesheet" href="/css/custom.css">
    

    

    
      
          <link href="/index.xml" rel="alternate" type="application/rss+xml" title="Nicola Iarocci" />
      
      
    
    <meta name="generator" content="Hugo 0.55.4" />

    <link rel="canonical" href="https://nicolaiarocci.com/convertire-una-data-json-in-un-oggetto-datetime-python/" />

    
      
    
    <script type="application/ld+json">
{
    "@context": "https://schema.org",
    "@type": "Article",
    "publisher": {
        "@type": "Organization",
        "name":  null 
    },
    "author": {
        "@type": "Person",
        "name":  null ,
        
        "url": "https://nicolaiarocci.com",
        "sameAs": [
            
            
             
             
             
             
             
            
        ]
    },
    "headline": "Convertire una data JSON in un oggetto datetime Python",
    "name": "Convertire una data JSON in un oggetto datetime Python",
    "wordCount":  502 ,
    "timeRequired": "PT3M",
    "inLanguage": {
      "@type": "Language",
      "alternateName": "en"
    },
    "url": "https://nicolaiarocci.com/convertire-una-data-json-in-un-oggetto-datetime-python/",
    "datePublished": "2012-06-07T00:00Z",
    "dateModified": "2012-06-07T00:00Z",
    
    "keywords": "datetime, json, programmazione, python",
    "description": "",
    "mainEntityOfPage": {
        "@type": "WebPage",
        "@id": "https://nicolaiarocci.com/convertire-una-data-json-in-un-oggetto-datetime-python/"
    }
}
    </script>
    


    

    
    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-19006041-1', 'auto');
      ga('send', 'pageview');

    </script>
    

    
</head>
<body class="nav-closed">

  <div class="nav">
    <h3 class="nav-title">Menu</h3>
    <a href="#" class="nav-close">
        <span class="hidden">Close</span>
    </a>
    <ul>
        
        
        
            
            <li class="nav-opened" role="presentation">
            	<a href="/">Blog</a>
            </li>
        
            
            <li class="nav-opened" role="presentation">
            	<a href="/about">About</a>
            </li>
        
            
            <li class="nav-opened" role="presentation">
            	<a href="/opensource">Open Source</a>
            </li>
        
            
            <li class="nav-opened" role="presentation">
            	<a href="/talks">Speaking</a>
            </li>
        
            
            <li class="nav-opened" role="presentation">
            	<a href="/books-i-have-read">Reading</a>
            </li>
        
            
            <li class="nav-opened" role="presentation">
            	<a href="/il-piccolo-libro-di-mongodb-edizione-italiana">MongoDB</a>
            </li>
        
            <h3>Subscribe</h3>
            <li class="nav-opened" role="presentation">
            	<a href="http://eepurl.com/b-_Pzz">New posts via mail</a>
            </li>
        
            
            <li class="nav-opened" role="presentation">
            	<a href="https://nicolaiarocci.com/index.xml">RSS feed</a>
            </li>
        
            <h3>Follow me</h3>
            <li class="nav-opened" role="presentation">
            	<a href="https://twitter.com/nicolaiarocci">Twitter</a>
            </li>
        
            
            <li class="nav-opened" role="presentation">
            	<a href="https://github.com/nicolaiarocci">Github</a>
            </li>
        
            
            <li class="nav-opened" role="presentation">
            	<a href="https://stackoverflow.com/users/323269/nicola-iarocci?tab=profile">Stack Overflow</a>
            </li>
        
            
            <li class="nav-opened" role="presentation">
            	<a href="http://speakerdeck.com/u/nicola">Speaker Deck</a>
            </li>
        
            
            <li class="nav-opened" role="presentation">
            	<a href="http://www.linkedin.com/in/nicolaiarocci">LinkedIn</a>
            </li>
        
        
    </ul>

    
    <a class="subscribe-button icon-feed" href="/index.xml">Subscribe</a>
    
</div>
<span class="nav-cover"></span>


 <div class="site-wrapper">



<header class="main-header post-head no-cover">
  <nav class="main-nav clearfix">


  
  
      <a class="menu-button" href="#"><span class="burger">&#9776;</span><span class="word">Menu</span></a>
  
  </nav>
</header>



<main class="content" role="main">




  <article class="post post">

    <header class="post-header">
        <h1 class="post-title">Convertire una data JSON in un oggetto datetime Python</h1>
        <small></small>

        <section class="post-meta">
        
          <time class="post-date" datetime="2012-06-07T00:00:00Z">
            Jun 7, 2012
          </time>
        
         
          <span class="post-tag small"><a href="https://nicolaiarocci.com//tags/datetime/">#datetime</a></span>
         
          <span class="post-tag small"><a href="https://nicolaiarocci.com//tags/json/">#json</a></span>
         
          <span class="post-tag small"><a href="https://nicolaiarocci.com//tags/programmazione/">#programmazione</a></span>
         
          <span class="post-tag small"><a href="https://nicolaiarocci.com//tags/python/">#python</a></span>
         
        </section>
    </header>

    <section class="post-content">
      

<p>Abbiamo una stringa JSON che contiene una data:</p>

<pre><code>fonte = '{&quot;ragione_sociale&quot;: &quot;CIR 2000&quot;, &quot;aggiornato_il&quot;: &quot;Wed, 06 Jun 2012 14:19:53 UTC&quot;}'
</code></pre>

<p>Vediamo che succede se la convertiamo in un dizionario Python:</p>

<pre><code>import simplejson as json

json.loads(fonte)
{'aggiornato_il': 'Wed, 06 Jun 2012 14:19:53 UTC ', 'ragione_sociale': 'CIR 2000'}
</code></pre>

<p>Facile, vero? C&#8217;è però un piccolo problema: <code>aggiornato_il</code> è ancora una stringa mentre a noi, per poterlo elaborare comodamente, serve un campo <code>datetime.datetime</code>. Come mai il pur potente modulo <code>simplejson</code> non converte correttamente la nostra data?</p>

<h2 id="il-problema">Il problema</h2>

<p>Il fatto è che il JSON originale non fa nulla per informarci del fatto che il campo <code>aggiornato_il</code> esprime in realtà una data. La radice del problema sta nello standard JSON il quale non contempla la dichiarazione esplicita dei tipi di dati. In effetti la stessa questione si pone nella conversione di un numero non intero: va considerato un float, oppure un decimal? In quest&#8217;ultimo caso <code>simplejson</code> ci viene in aiuto con il parametro parse_float:</p>

<pre><code>import simplejson as json

json.loads('1.1', parse_float=decimal.Decimal)
Decimal('1.1')
</code></pre>

<p>Purtroppo, per il motivo visto prima, non esiste un equivalente per le date.</p>

<h2 id="la-soluzione-classica">La soluzione classica</h2>

<p>In questi casi la prassi comune è rendere esplicito, già all&#8217;interno della stringa JSON, il formato del campo. Qualcosa del genere:</p>

<pre><code>{&quot;aggiornato_il&quot;: &quot;$date: Wed, 06 Jun 2012 14:19:53 UTC&quot;}
</code></pre>

<p>Così facendo possiamo in seguito manipolare il dizionario restituito dal metodo <code>loads</code>: intercettare la direttiva <code>$date</code> e sostituire finalmente la stringa con una data. Una soluzione più raffinata è quella di sfruttare l&#8217;opzione <code>object_hook</code> che consente di invocare una nostra funzione ad ogni chiamata del metodo <code>loads</code>.</p>

<h2 id="la-mia-soluzione">La mia soluzione</h2>

<p>Nel mio caso il provider JSON è esterno, e non desidero obbligarlo a pre-processare le stringhe JSON inserendo clausole $date arbitrarie solo per soddisfare le esigenze della mia applicazione. Sfruttando l&#8217;opzione object_hook già accennata ho ottenuto una soluzione del tutto trasparente:</p>

<pre><code>fonte = '{&quot;aggiornato_il&quot;: &quot;Thu, 1 Mar 2012 10:00:49 UTC&quot;}'
dct = json.loads(fonte, object_hook=datetime_parser)
dct
{u'aggiornato_il': datetime.datetime(2012, 3, 1, 10, 0, 49)}


def datetime_parser(dct):
    for k, v in dct.items():
        if isinstance(v, basestring) and re.search(&quot; UTC&quot;, v):
            try:
                dct[k] = datetime.datetime.strptime(v, DATE_FORMAT)
            except:
                pass
    return dct
</code></pre>

<p>La funzione <code>datetime_parser</code> esamina gli elementi della stringa JSON. In caso di corrispondenza alla espressione regolare indicata in <code>re.search</code> tentiamo una conversione diretta al formato <code>datetime</code>. Data la specificità della espressione regolare la conversione dovrebbe avere successo. Il blocco <code>try... except</code> ci permette di ignorare un eventuale errore: in questo caso infatti presumiamo che si tratti di una stringa vera e propria e non, malgrado la somiglianza, di una data. L&#8217;unico vincolo imposto al provider JSON è l&#8217;adozione di un formato standard per rappresentare le date. Nel mio caso è il seguente:</p>

<pre><code>DATE_FORMAT = '%a, %d %b %Y %H:%M:%S UTC'
</code></pre>

<p>Per approfondimenti vi consiglio:</p>

<ul>
<li><a title="JSON encoder and decoder" href="http://docs.python.org/library/json.html" target="_blank">JSON econdoer and decoder</a></li>
<li><a href="http://nicolaiarocci.com/introduzione-alle-regular-expression-prima-parte/" title="Introduzione alle Regular Expression">Introduzione alle Regular Expression</a></li>
</ul>

<p>Per completezza c&#8217;è da aggiungere che l&#8217;adozione di un <a title="json schema" href="http://www.google.it/url?sa=t&rct=j&q=&esrc=s&source=web&cd=1&ved=0CGgQFjAA&url=http%3A%2F%2Fjson-schema.org%2F&ei=-GrQT_rzHYbHsgb9ob36DQ&usg=AFQjCNE-i8CJOQfjyG2n0It-nN20sJ-cZg" target="_blank">json schema</a> consentirebbe la specifica dei tipi di dati JSON. Quest&#8217;ultima soluzione però, data la sua complessità, non è applicabile nel mio e in molti altri casi.</p>

<p>PS: ne ho scritto anche su <a title="How to convert a python datetime object with json loads" href="http://stackoverflow.com/questions/8793448/how-to-convert-to-a-python-datetime-object-with-json-loads/10734224#10734224" target="_blank">Stack Overflow</a>.</p>

    </section>


  <footer class="post-footer">


    









<section class="author">
  <h4><a href="https://nicolaiarocci.com/">Nicola Iarocci</a></h4>
  
  <p>Read <a href="https://nicolaiarocci.com/">more posts</a> by this author.</p>
  
  <div class="author-meta">
    <span class="author-location icon-location">Ravenna, Italy</span>
    <span class="author-link icon-link"><a href="https://nicolaiarocci.com">https://nicolaiarocci.com</a></span>
  </div>
</section>




    
<section class="share">
  <h4>Share this post</h4>
  <a class="icon-twitter" style="font-size: 1.4em" href="https://twitter.com/share?text=Convertire%20una%20data%20JSON%20in%20un%20oggetto%20datetime%20Python&nbsp;-&nbsp;Nicola%20Iarocci&amp;url=https%3a%2f%2fnicolaiarocci.com%2fconvertire-una-data-json-in-un-oggetto-datetime-python%2f"
      onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;">
      <span class="hidden">Twitter</span>
  </a>
  <a class="icon-facebook" style="font-size: 1.4em" href="https://www.facebook.com/sharer/sharer.php?u=https%3a%2f%2fnicolaiarocci.com%2fconvertire-una-data-json-in-un-oggetto-datetime-python%2f"
      onclick="window.open(this.href, 'facebook-share','width=580,height=296');return false;">
      <span class="hidden">Facebook</span>
  </a>
  <a class="icon-pinterest" style="font-size: 1.4em" href="http://pinterest.com/pin/create/button/?url=https%3a%2f%2fnicolaiarocci.com%2fconvertire-una-data-json-in-un-oggetto-datetime-python%2f&amp;description=Convertire%20una%20data%20JSON%20in%20un%20oggetto%20datetime%20Python"
      onclick="window.open(this.href, 'pinterest-share','width=580,height=296');return false;">
      <span class="hidden">Pinterest</span>
  </a>
  <a class="icon-google-plus" style="font-size: 1.4em" href="https://plus.google.com/share?url=https%3a%2f%2fnicolaiarocci.com%2fconvertire-una-data-json-in-un-oggetto-datetime-python%2f"
     onclick="window.open(this.href, 'google-plus-share', 'width=490,height=530');return false;">
      <span class="hidden">Google+</span>
  </a>
</section>



    







  </footer>
</article>

</main>


  <aside class="read-next">
  
      <a class="read-next-story" style="no-cover" href="/windows-azure-ora-supporta-ufficialmente-python/">
          <section class="post">
              <h2>Windows Azure ora supporta ufficialmente Python</h2>
              
          </section>
      </a>
  
  
      <a class="read-next-story prev" style="no-cover" href="/il-mio-intervento-al-cna-barcamp-video/">
          <section class="post">
              <h2>Il filmato del mio intervento al Ravenna CNA BarCamp</h2>
          </section>
      </a>
  
</aside>



    <footer class="site-footer clearfix">
        <section class="copyright"><a href="">Nicola Iarocci</a> All rights reserved</section>
        
    </footer>
    </div>
    <script type="text/javascript" src="/js/jquery.js"></script>
    <script type="text/javascript" src="/js/jquery.fitvids.js"></script>
    <script type="text/javascript" src="/js/index.js"></script>
    
</body>
</html>

