<!DOCTYPE html>
<html lang="en-US">
<head>

    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />

    
    
        <meta name="twitter:card" content="summary"/>
    



<meta name="twitter:title" content="Validating user objects with Cerberus"/>
<meta name="twitter:description" content=""/>
<meta name="twitter:site" content="@"/>



  	<meta property="og:title" content="Validating user objects with Cerberus &middot; Nicola Iarocci" />
  	<meta property="og:site_name" content="Nicola Iarocci" />
  	<meta property="og:url" content="https://nicolaiarocci.com/validating-user-objects-cerberus/" />

    
        
    

    
    <meta property="og:description" content="" />
  	<meta property="og:type" content="article" />
    <meta property="article:published_time" content="2015-01-05T00:00:00Z" />

    
    <meta property="article:tag" content="cerberus" />
    
    <meta property="article:tag" content="python" />
    
    

    <title>Validating user objects with Cerberus &middot; Nicola Iarocci</title>

    
    <meta name="description" content="People keep telling me that they want to validate class and instance attributes (object properties) with Cerberus. While it certainly wasn&amp;#8217;t conceived wit" />
    

    <meta name="HandheldFriendly" content="True" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <link rel="shortcut icon" href="/images/favicon.ico">
	  <link rel="apple-touch-icon" href="/images/apple-touch-icon.png" />

    <link rel="stylesheet" type="text/css" href="/css/screen.css" />
    <link rel="stylesheet" type="text/css" href="/css/nav.css" />

    
    <link rel="stylesheet" href="/css/custom.css">
    

    

    
      
          <link href="/index.xml" rel="alternate" type="application/rss+xml" title="Nicola Iarocci" />
      
      
    
    <meta name="generator" content="Hugo 0.55.4" />

    <link rel="canonical" href="https://nicolaiarocci.com/validating-user-objects-cerberus/" />

    
      
    
    <script type="application/ld+json">
{
    "@context": "https://schema.org",
    "@type": "Article",
    "publisher": {
        "@type": "Organization",
        "name":  null 
    },
    "author": {
        "@type": "Person",
        "name":  null ,
        
        "url": "https://nicolaiarocci.com",
        "sameAs": [
            
            
             
             
             
             
             
            
        ]
    },
    "headline": "Validating user objects with Cerberus",
    "name": "Validating user objects with Cerberus",
    "wordCount":  744 ,
    "timeRequired": "PT4M",
    "inLanguage": {
      "@type": "Language",
      "alternateName": "en"
    },
    "url": "https://nicolaiarocci.com/validating-user-objects-cerberus/",
    "datePublished": "2015-01-05T00:00Z",
    "dateModified": "2015-01-05T00:00Z",
    
    "keywords": "cerberus, python",
    "description": "",
    "mainEntityOfPage": {
        "@type": "WebPage",
        "@id": "https://nicolaiarocci.com/validating-user-objects-cerberus/"
    }
}
    </script>
    


    

    
    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-19006041-1', 'auto');
      ga('send', 'pageview');

    </script>
    

    
</head>
<body class="nav-closed">

  <div class="nav">
    <h3 class="nav-title">Menu</h3>
    <a href="#" class="nav-close">
        <span class="hidden">Close</span>
    </a>
    <ul>
        
        
        
            
            <li class="nav-opened" role="presentation">
            	<a href="/">Blog</a>
            </li>
        
            
            <li class="nav-opened" role="presentation">
            	<a href="/about">About</a>
            </li>
        
            
            <li class="nav-opened" role="presentation">
            	<a href="/opensource">Open Source</a>
            </li>
        
            
            <li class="nav-opened" role="presentation">
            	<a href="/talks">Speaking</a>
            </li>
        
            
            <li class="nav-opened" role="presentation">
            	<a href="/books-i-have-read">Reading</a>
            </li>
        
            
            <li class="nav-opened" role="presentation">
            	<a href="/il-piccolo-libro-di-mongodb-edizione-italiana">MongoDB</a>
            </li>
        
            <h3>Subscribe</h3>
            <li class="nav-opened" role="presentation">
            	<a href="http://eepurl.com/b-_Pzz">New posts via mail</a>
            </li>
        
            
            <li class="nav-opened" role="presentation">
            	<a href="https://nicolaiarocci.com/index.xml">RSS feed</a>
            </li>
        
            <h3>Follow me</h3>
            <li class="nav-opened" role="presentation">
            	<a href="https://twitter.com/nicolaiarocci">Twitter</a>
            </li>
        
            
            <li class="nav-opened" role="presentation">
            	<a href="https://github.com/nicolaiarocci">Github</a>
            </li>
        
            
            <li class="nav-opened" role="presentation">
            	<a href="https://stackoverflow.com/users/323269/nicola-iarocci?tab=profile">Stack Overflow</a>
            </li>
        
            
            <li class="nav-opened" role="presentation">
            	<a href="http://speakerdeck.com/u/nicola">Speaker Deck</a>
            </li>
        
            
            <li class="nav-opened" role="presentation">
            	<a href="http://www.linkedin.com/in/nicolaiarocci">LinkedIn</a>
            </li>
        
        
    </ul>

    
    <a class="subscribe-button icon-feed" href="/index.xml">Subscribe</a>
    
</div>
<span class="nav-cover"></span>


 <div class="site-wrapper">



<header class="main-header post-head no-cover">
  <nav class="main-nav clearfix">


  
  
      <a class="menu-button" href="#"><span class="burger">&#9776;</span><span class="word">Menu</span></a>
  
  </nav>
</header>



<main class="content" role="main">




  <article class="post post">

    <header class="post-header">
        <h1 class="post-title">Validating user objects with Cerberus</h1>
        <small></small>

        <section class="post-meta">
        
          <time class="post-date" datetime="2015-01-05T00:00:00Z">
            Jan 5, 2015
          </time>
        
         
          <span class="post-tag small"><a href="https://nicolaiarocci.com//tags/cerberus/">#cerberus</a></span>
         
          <span class="post-tag small"><a href="https://nicolaiarocci.com//tags/python/">#python</a></span>
         
        </section>
    </header>

    <section class="post-content">
      

<p>People keep telling me that they want to validate class and instance attributes (object properties) with <a href="https://github.com/nicolaiarocci/cerberus">Cerberus</a>. While it certainly wasn&#8217;t conceived with that goal in mind, it is actually very possible to leverage both the Python <a href="https://docs.python.org/2/reference/datamodel.html">data model</a> and Cerberus <a href="http://cerberus.readthedocs.org/en/latest/#custom-validators">extensibility</a> to achieve object validation.</p>

<h2 id="nuts-bolts">Nuts &amp; Bolts</h2>

<p>Let&#8217;s say that we have a simple class:</p>

<pre><code>&gt;&gt;&gt; class Person(object):
...     pass
</code></pre>

<p>We create a <code>Person</code> instance and add a few properties and values:</p>

<pre><code>&gt;&gt;&gt; p = Person()
&gt;&gt;&gt; p.name = &quot;bill&quot;
&gt;&gt;&gt; p.age = 44
</code></pre>

<p>Now let&#8217;s instance a Cerberus Validator and set up some validation rules for it:</p>

<pre><code>&gt;&gt;&gt; from Cerberus import Validator
&gt;&gt;&gt; schema = {
...     'name': {'type': 'string'},
...     'age': {'type': 'integer', 'min': 0}
... }
&gt;&gt;&gt; v = Validator(schema)
</code></pre>

<p>As you probably know already, all Python user objects have a <code>__dict__</code> magic method which exposes class and instance attributes as a dictionary. This means that we can also query our class like this:</p>

<pre><code>&gt;&gt;&gt; p.__dict__
{'name': 'bill', 'age': 44}

&gt;&gt;&gt; p.__dict__['age']
44
</code></pre>

<p>You see where we are going with this: we can exploit the <code>__dict__</code> method in order to let Cerberus perform validation on our object:</p>

<pre><code>&gt;&gt;&gt; v.validate(p.__dict__)
True
</code></pre>

<p>Validation succeeds because current attribute values do not break any rule. However, if we break the rules we do get what we deserve:</p>

<pre><code>&gt;&gt;&gt; p.age = -1
&gt;&gt;&gt; v.validate(p.__dict__)
False

&gt;&gt;&gt; v.errors
{'age': 'min value is 0'}
</code></pre>

<p>This works, but is somewhat clumsy. We can do better.</p>

<h2 id="a-custom-object-validator">A Custom Object Validator</h2>

<p>How about letting the Validator do the work for us? We could subclass the standard Validator and extend it to natively support object validation.</p>

<pre><code>&gt;&gt;&gt; class ObjectValidator(Validator):
...     def validate_object(self, obj):
...         return self.validate(obj.__dict__)
...

&gt;&gt;&gt; v = ObjectValidator(schema)
&gt;&gt;&gt; v.validate_object(p)
False

&gt;&gt;&gt; v.errors
{'age': 'min value is 0'}

&gt;&gt;&gt; p.age = 44
&gt;&gt;&gt; v.validate_object(p)
True
</code></pre>

<p>Much better. But what happens if we add a new property and then validate the object?</p>

<pre><code>&gt;&gt;&gt; p.lastname = 'white'
&gt;&gt;&gt; v.validate_object(p)
False

&gt;&gt;&gt; v.errors
{'lastname': 'unknown field'}
</code></pre>

<p>Validation fails because by default unknown fields are not allowed. This might not be the desired behaviour. If this is the case, we simply need to update the helper method in our custom validator class:</p>

<pre><code>&gt;&gt;&gt; class ObjectValidator(Validator):
...     def validate_object(self, obj):
...         self.allow_unknown = True
...         return self.validate(obj.__dict__)

&gt;&gt;&gt; v.validate_object(p)
True
</code></pre>

<p>By setting <code>allow_unknown</code> to <code>True</code> we <a href="http://cerberus.readthedocs.org/en/latest/#allowing-the-unknown">let unknown fields be ignored</a> by validation. If we are not concerned by state changes between calls we might conveniently choose to move the setting of <code>allow_unknown</code> to the <code>__init__</code> method so it gets executed only once.</p>

<p>Looks good so far. We can validate simple objects. But what about complex ones like those exposing other objects as attributes? This is going to require some more tinkering.</p>

<h2 id="validating-complex-objects">Validating Complex Objects</h2>

<p>It would be super handy if we could add support for an <code>object</code> data type and then provide a validation schema for it, like we already do with the <code>dict</code> and <code>list</code> types. A revised validation schema would then look like this:</p>

<pre><code>&gt;&gt;&gt; schema = {
...     'name': {'type': 'string'},
...     'age': {'type': 'integer', 'min': 0},
...     'address': {
...         'type': 'object',
            'schema': {
...             'street': {'type': 'string'},
...             'zip': {'type': 'integer'}
...         }
...     }
... }
</code></pre>

<p>We could then validate it like so:</p>

<pre><code>&gt;&gt;&gt; class Address
...     pass

&gt;&gt;&gt; addr = Address()
&gt;&gt;&gt; addr.street = 'Lexington'
&gt;&gt;&gt; addr.zip = 50238
&gt;&gt;&gt; p.address = addr

&gt;&gt;&gt; v.validate_object(p)
True

&gt;&gt;&gt; p.address.zip = 'not a number'
&gt;&gt;&gt; v.validate_object(p)
False

&gt;&gt;&gt; v.errors
{'address': {'zip': 'must be of integer type'}}
</code></pre>

<p>It turns out this is also very achievable. We can leverage Cerberus <a href="http://cerberus.readthedocs.org/en/latest/#adding-new-data-types">data type extensibility model</a> to add support for the <code>object</code> type. Then it is just a matter of handling the new type when validating the <code>schema</code> rule. I&#8217;m not going into details here but you can check <a href="https://gist.github.com/nicolaiarocci/829c98eb5f8b4e9c96c1">Validating complex objects with Cerberus</a>, a trivial implementation I posted as a GitHub gist.</p>

<h2 id="closing-note">Closing note</h2>

<p>You might be wondering why don&#8217;t I add object validation to Cerberus core. Actually, I don&#8217;t rule out this possibility but see I like to keep tools as simple, targeted and focused as possible. Besides, there are other object validation tools out there, so adding a new flavour does not seem very useful to me (but let me know if you feel otherwise.) Though as we have seen, if you want to validate user objects with Cerberus, you can do that easily enough.</p>

<p>If you want to get in touch, I am @<a href="http://twitter.com/nicolaiarocci">nicolaiarocci</a> on Twitter.</p>

    </section>


  <footer class="post-footer">


    









<section class="author">
  <h4><a href="https://nicolaiarocci.com/">Nicola Iarocci</a></h4>
  
  <p>Read <a href="https://nicolaiarocci.com/">more posts</a> by this author.</p>
  
  <div class="author-meta">
    <span class="author-location icon-location">Ravenna, Italy</span>
    <span class="author-link icon-link"><a href="https://nicolaiarocci.com">https://nicolaiarocci.com</a></span>
  </div>
</section>




    
<section class="share">
  <h4>Share this post</h4>
  <a class="icon-twitter" style="font-size: 1.4em" href="https://twitter.com/share?text=Validating%20user%20objects%20with%20Cerberus&nbsp;-&nbsp;Nicola%20Iarocci&amp;url=https%3a%2f%2fnicolaiarocci.com%2fvalidating-user-objects-cerberus%2f"
      onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;">
      <span class="hidden">Twitter</span>
  </a>
  <a class="icon-facebook" style="font-size: 1.4em" href="https://www.facebook.com/sharer/sharer.php?u=https%3a%2f%2fnicolaiarocci.com%2fvalidating-user-objects-cerberus%2f"
      onclick="window.open(this.href, 'facebook-share','width=580,height=296');return false;">
      <span class="hidden">Facebook</span>
  </a>
  <a class="icon-pinterest" style="font-size: 1.4em" href="http://pinterest.com/pin/create/button/?url=https%3a%2f%2fnicolaiarocci.com%2fvalidating-user-objects-cerberus%2f&amp;description=Validating%20user%20objects%20with%20Cerberus"
      onclick="window.open(this.href, 'pinterest-share','width=580,height=296');return false;">
      <span class="hidden">Pinterest</span>
  </a>
  <a class="icon-google-plus" style="font-size: 1.4em" href="https://plus.google.com/share?url=https%3a%2f%2fnicolaiarocci.com%2fvalidating-user-objects-cerberus%2f"
     onclick="window.open(this.href, 'google-plus-share', 'width=490,height=530');return false;">
      <span class="hidden">Google+</span>
  </a>
</section>



    







  </footer>
</article>

</main>


  <aside class="read-next">
  
      <a class="read-next-story" style="no-cover" href="/on-reusable-software/">
          <section class="post">
              <h2>On Reusable Software</h2>
              
          </section>
      </a>
  
  
      <a class="read-next-story prev" style="no-cover" href="/some-thoughts-on-the-new-net-redux/">
          <section class="post">
              <h2>Some Thoughts on the new .NET (Redux)</h2>
          </section>
      </a>
  
</aside>



    <footer class="site-footer clearfix">
        <section class="copyright"><a href="">Nicola Iarocci</a> All rights reserved</section>
        
    </footer>
    </div>
    <script type="text/javascript" src="/js/jquery.js"></script>
    <script type="text/javascript" src="/js/jquery.fitvids.js"></script>
    <script type="text/javascript" src="/js/index.js"></script>
    
</body>
</html>

